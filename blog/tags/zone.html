<!doctype html>
<html lang="zh-Hans" dir="ltr" class="blog-wrapper blog-tags-post-list-page plugin-blog plugin-id-default">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v2.3.1">
<title data-rh="true">1 篇博文 含有标签「zone」 | ZUtil</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://duanluan.github.io/ZUtil/blog/tags/zone"><meta data-rh="true" name="docusaurus_locale" content="zh-Hans"><meta data-rh="true" name="docsearch:language" content="zh-Hans"><meta data-rh="true" property="og:title" content="1 篇博文 含有标签「zone」 | ZUtil"><meta data-rh="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-rh="true" name="docsearch:docusaurus_tag" content="blog_tags_posts"><link data-rh="true" rel="icon" href="/ZUtil/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://duanluan.github.io/ZUtil/blog/tags/zone"><link data-rh="true" rel="alternate" href="https://duanluan.github.io/ZUtil/blog/tags/zone" hreflang="zh-Hans"><link data-rh="true" rel="alternate" href="https://duanluan.github.io/ZUtil/blog/tags/zone" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/ZUtil/blog/rss.xml" title="ZUtil RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/ZUtil/blog/atom.xml" title="ZUtil Atom Feed"><link rel="stylesheet" href="/ZUtil/assets/css/styles.cd6ae25b.css">
<link rel="preload" href="/ZUtil/assets/js/runtime~main.90331c9c.js" as="script">
<link rel="preload" href="/ZUtil/assets/js/main.47fca1f3.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/ZUtil/"><div class="navbar__logo"><img src="/ZUtil/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/ZUtil/img/logo.svg" alt="My Site Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">ZUtil</b></a><a class="navbar__item navbar__link" href="/ZUtil/docs/intro">教程</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/ZUtil/blog">博客</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item"><a href="https://github.com/duanluan/ZUtil" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link header-github-link" aria-label="GitHub repository"></a></div><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_re4s thin-scrollbar" aria-label="最近博文导航"><div class="sidebarItemTitle_pO2u margin-bottom--md">Recent posts</div><ul class="sidebarItemList_Yudw clean-list"><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ZUtil/blog/javaTimeZone">java.time 时区详解</a></li><li class="sidebarItem__DBe"><a class="sidebarItemLink_mo7H" href="/ZUtil/blog/welcome">欢迎</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><header class="margin-bottom--xl"><h1>1 篇博文 含有标签「zone」</h1><a href="/ZUtil/blog/tags">查看所有标签</a></header><article class="margin-bottom--xl" itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h2 class="title_f1Hy" itemprop="headline"><a itemprop="url" href="/ZUtil/blog/javaTimeZone">java.time 时区详解</a></h2><div class="container_mt6G margin-vert--md"><time datetime="2022-07-29T00:00:00.000Z" itemprop="datePublished">2022年7月29日</time> · <!-- -->阅读需 16 分钟</div><div class="margin-top--md margin-bottom--sm row"><div class="col col--6 authorCol_Hf19"><div class="avatar margin-bottom--sm"><a href="https://github.com/duanluan" target="_blank" rel="noopener noreferrer" class="avatar__photo-link"><img class="avatar__photo" src="https://github.com/duanluan.png" alt="ZhongJianhao"></a><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a href="https://github.com/duanluan" target="_blank" rel="noopener noreferrer" itemprop="url"><span itemprop="name">ZhongJianhao</span></a></div><small class="avatar__subtitle" itemprop="description">Maintainer of ZUtil</small></div></div></div></div></header><div class="markdown" itemprop="articleBody"><p><code>LocalDateTime</code>类是不包含时区信息的，可以通过<code>atZone</code>方法来设置<code>ZoneId</code>，返回<code>ZonedDateTime</code>类实例，通过<code>atOffset</code>方法来设置<code>ZoneOffset</code>，返回<code>OffsetDateTime</code>类实例。</p><p><img loading="lazy" src="/ZUtil/assets/images/java.time.drawio-f8bd73a2d32a84f8214ddba9bbc988d5.png" width="506" height="232" class="img_ev3q"></p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="zoneddatetime-类注释详解">ZonedDateTime 类注释详解<a href="#zoneddatetime-类注释详解" class="hash-link" aria-label="ZonedDateTime 类注释详解的直接链接" title="ZonedDateTime 类注释详解的直接链接">​</a></h2><p>我们来逐段解读一下 ZonedDateTime 类的注释。</p><blockquote><p>A date-time with a time-zone in the ISO-8601 calendar system, such as <code>2007-12-03T10:15:30+01:00 Europe/Paris</code>.</p><p>ISO-8601 日历系统中带时区的日期时间，例如<code>2007-12-03T10:15:30+01:00 Europe/Paris</code>。</p></blockquote><p><a href="https://zh.wikipedia.org/wiki/ISO_8601" target="_blank" rel="noopener noreferrer">ISO-8601</a> 我们简单理解为是规定日期和时间如何表示的标准即可，此处不深入研究。</p><p><code>2007-12-03T10:15:30+01:00 Europe/Paris</code>中，<code>2007-12-03</code>为年月日；<code>T</code>是日期和时间组合表示时的固定写法，用于分隔；<code>10:15:30</code>是小时分钟秒；<code>+01:00</code>是此日期时间与 UTC 的时差为 +1 小时，即<strong>时区偏移（ZoneOffset）</strong>；<code>Europe/Paris</code>是指此日期时间的所在区域为欧洲/巴黎，即<strong>时区 ID（ZoneId）</strong>，time-zone ID 请查看：<a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" target="_blank" rel="noopener noreferrer">List of tz database time zones</a>。</p><blockquote><p>ZonedDateTime is an immutable representation of a date-time with a time-zone. This class stores all date and time fields, to a precision of nanoseconds, and a time-zone, with a zone offset used to handle ambiguous local date-times. For example, the value &quot;2nd October 2007 at 13:45.30.123456789 +02:00 in the Europe/Paris time-zone&quot; can be stored in a <code>ZonedDateTime</code>.</p><p>ZonedDateTime 是带时区的日期时间的常量表示。此类存储所有的日期时间（精确到纳秒）和时区，其中时区偏移用于处理不明确的本地日期时间。 例如，值“2nd October 2007 at 13:45.30.123456789 +02:00 in the Europe/Paris time-zone” 可以被存储在<code>ZonedDateTime</code>中。</p></blockquote><p>说它是常量是因为此类是被<code>final</code>修饰的，调用它的方法时，<strong>返回</strong>的都是<strong>新实例</strong>。</p><p>“时区偏移用于处理不明确的本地日期时间”，之所以不明确，是因为<a href="https://zh.wikipedia.org/wiki/%E5%A4%8F%E4%BB%A4%E6%97%B6" target="_blank" rel="noopener noreferrer">夏令时</a>的存在，同一地区，不同月份，甚至不同年份的 ZoneOffset 可能不一样。详见<a href="https://zh.wikipedia.org/wiki/%E6%97%B6%E5%8C%BA%E4%BF%A1%E6%81%AF%E6%95%B0%E6%8D%AE%E5%BA%93" target="_blank" rel="noopener noreferrer">时区信息数据库</a>。</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">LocalDateTime localDateTime = LocalDateTime.of(2022, 1, 1, 0, 0);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 设置时区 ID 为 美国/纽约</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ZonedDateTime zonedDateTime = localDateTime.atZone(ZoneId.of(&quot;America/New_York&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 输出为 -05:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(zonedDateTime.getOffset());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 设置月份为 4 月，即夏令时</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zonedDateTime = zonedDateTime.withMonth(4);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 输出为 -04:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(zonedDateTime.getOffset());</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>This class handles conversion from the local time-line of <code>LocalDateTime</code> to the instant time-line of <code>Instant</code>. The difference between the two time-lines is the offset from UTC/Greenwich, represented by a <code>ZoneOffset</code>.</p><p>此类处理<code>LocalDateTime</code>的本地时间线到<code>Instant</code>的瞬时时间线。两条时间线的差异是与 UTC/Greenwich 的偏移量，由<code>ZoneOffset</code>表示。</p></blockquote><p><strong>Instant（瞬时）</strong>简单来说就是 java.time 中的时间戳（精度为纳秒），不包含时区信息。</p><p>此处说“两条时间线的差异是与 UTC/Greenwich 的偏移量”是指 Instant 加上 ZoneOffset 就可以获取 LocalDateTime。但如果是要将 Instant 转换为 ZonedDateTime 的话，需要设置 ZoneId。</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Instant instant = Instant.now();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LocalDateTime localDateTime = instant.atOffset(ZoneOffset.ofHours(8)).toLocalDateTime();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ZonedDateTime zonedDateTime = instant.atZone(ZoneId.systemDefault());</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><blockquote><p>Converting between the two time-lines involves calculating the offset using the <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/zone/ZoneRules.html" target="_blank" rel="noopener noreferrer">rules</a> accessed from the <code>ZoneId</code>. Obtaining the offset for an instant is simple, as there is exactly one valid offset for each instant. By contrast, obtaining the offset for a local date-time is not straightforward. There are three cases:</p><ul><li>Normal, with one valid offset. For the vast majority of the year, the normal case applies, where there is a single valid offset for the local date-time.</li><li>Gap, with zero valid offsets. This is when clocks jump forward typically due to the spring daylight savings change from &quot;winter&quot; to &quot;summer&quot;. In a gap there are local date-time values with no valid offset.</li><li>Overlap, with two valid offsets. This is when clocks are set back typically due to the autumn daylight savings change from &quot;summer&quot; to &quot;winter&quot;. In an overlap there are local date-time values with two valid offsets.</li></ul><p>两条时间线之间的转换涉及到使用<code>ZoneId</code>访问<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/zone/ZoneRules.html" target="_blank" rel="noopener noreferrer">规则</a>（ZoneRules）计算偏移量。获取一个 instant 的偏移量很简单，因为每个 instant 正好有一个有效偏移量。相比之下，获取一个 local date-time 的有效偏移量
并不简单。有三种情况：</p><ul><li>正常：有一个有效的偏移量。在一年中的绝大多数时间里，local date-time 有一个有效的偏移量。</li><li>间隙：没有有效的偏移量。这是由于春季夏令时从“冬季”到“夏季”，时钟被调快了，跳过了一段时间。在跳过的间隙中，有 local date-time，但没有有效的偏移量。</li><li>重叠：有两个有效的偏移量。这是由于秋季夏令时从“夏季”到“冬季”，时钟往回调了一段时间。在重叠的情况下，有两个有效的偏移量的 local date-time。</li></ul><p>Any method that converts directly or implicitly from a local date-time to an instant by obtaining the offset has the potential to be complicated.</p><p>For Gaps, the general strategy is that if the local date-time falls in the middle of a Gap, then the resulting zoned date-time will have a local date-time shifted forwards by the length of the Gap, resulting in a date-time in the later offset, typically &quot;summer&quot; time.</p><p>For Overlaps, the general strategy is that if the local date-time falls in the middle of an Overlap, then the previous offset will be retained. If there is no previous offset, or the previous offset is invalid, then the earlier offset is used, typically &quot;summer&quot; time.. Two additional methods, <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/ZonedDateTime.html#withEarlierOffsetAtOverlap()" target="_blank" rel="noopener noreferrer">withEarlierOffsetAtOverlap()</a> and <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/ZonedDateTime.html#withLaterOffsetAtOverlap()" target="_blank" rel="noopener noreferrer">withLaterOffsetAtOverlap()</a>, help manage the case of an overlap.</p><p>任何通过获取偏移量显式或隐式地将 local date-time 转换为 instant 地方都有可能变得复杂。</p><p>对于间隙，一般策略是，如果 local date-time 落在间隙中间，那么产生的 zoned date-time 是 local date-time 向前移动间歇的长度后的，导致日期在较晚的偏移量，通常是“夏季”时间。</p><p>对于重叠，一般策略是，如果 local date-time 落在重叠中间，那么以前的偏移量将被保留。如果以前没有偏移量，或者以前的偏移量无效，那么就使用较早的偏移量，通常是“夏季”时间。两个额外的方法，<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/ZonedDateTime.html#withEarlierOffsetAtOverlap()" target="_blank" rel="noopener noreferrer">withEarlierOffsetAtOverlap()</a> and <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/ZonedDateTime.html#withLaterOffsetAtOverlap()" target="_blank" rel="noopener noreferrer">withLaterOffsetAtOverlap()</a>，可以帮助管理重合的情况。</p><p>In terms of design, this class should be viewed primarily as the combination of a <code>LocalDateTime</code> and a <code>ZoneId</code>. The <code>ZoneOffset</code> is a vital, but secondary, piece of information, used to ensure that the class represents an instant, especially during a daylight savings overlap.</p><p>就设计而言，这个类应该主要被看作是<code>LocalDateTime</code>和<code>ZoneId</code>的组合。<code>ZoneOffset</code>是一个重要但次要的信息，用来确保这个类代表一个瞬间，特别是在夏令时重叠的时候。</p></blockquote><p>此处举例，美国夏令时一般在 <strong>3 月第二个周日 2AM</strong> 开始，将时钟拨快 1 小时，调到 3 点，那这一小时就是“冬季”到“夏季”的<strong>间隙（Gap）</strong>；在 <strong>11 月第一个周日 2AM</strong>，又会将时钟拨慢 1 小时，调回到 1 点，那这一小时就是“夏季”到“冬季”的<strong>重叠（Overlap）</strong>。</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ZoneId zoneId = ZoneId.of(&quot;America/New_York&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ZoneRules zoneRules = zoneId.getRules();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 美国/纽约 2022 年的夏令时间歇时间为 03-13 02:00 ~ 03:00（不包含 03:00）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LocalDateTime localDateTime = LocalDateTime.of(2022, 3, 13, 2, 30);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ZoneOffsetTransition zoneRulesTransition = zoneRules.getTransition(localDateTime);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(zoneRulesTransition);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(zoneRules.getTransition(localDateTime.plusMinutes(30)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 如果时间落在间歇中间，那对应的 zoned date-time 会加上间歇长度（此处为 1 小时），同时时区偏移量为夏令时偏移量。</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(localDateTime.atZone(zoneId));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 输出结果为：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Transition[Gap at 2022-03-13T02:00-05:00 to -04:00]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-03-13T03:30-04:00[America/New_York]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>说“间歇没有有效的偏移量”，是因为落在间歇再转换为 zoned date-time 后，会自动加上间歇长度，所以那段时间只有 local date-time，没有偏移量。</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ZoneId zoneId = ZoneId.of(&quot;America/New_York&quot;);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ZoneRules zoneRules = zoneId.getRules();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 美国/纽约 2022 年的夏令时重叠时间为 11-06 01:00 ~ 02:00（不包含 02:00）</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">LocalDateTime localDateTime = LocalDateTime.of(2022, 11, 6, 1, 30);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ZoneOffsetTransition zoneRulesTransition = zoneRules.getTransition(localDateTime);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(zoneRulesTransition);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(zoneRules.getTransition(localDateTime.plusMinutes(30)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 如果时间落在重叠中间，以前没有偏移量或者以前的偏移量无效时，会使用较早的偏移量，即夏令时偏移量 -04:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(localDateTime.atZone(zoneId));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 如果时间落在重叠中间，以前有偏移量且更晚时，会使用较晚的偏移量，即非夏令时偏移量 -05:00</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(localDateTime.atOffset(ZoneOffset.ofHours(-6)).atZoneSameInstant(zoneId));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 输出结果为：</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Transition[Overlap at 2022-11-06T02:00-04:00 to -05:00]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">null</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-11-06T01:30-04:00[America/New_York]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-11-06T02:30-05:00[America/New_York]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>说“重叠有两个有效的偏移量”，是因为落在重叠时，如果以前没有偏移量或者以前的偏移量无效时，会使用较早的偏移量；如果以前有偏移量且更晚时，会使用较晚的偏移量。</p><blockquote><p>This is a <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/doc-files/ValueBased.html" target="_blank" rel="noopener noreferrer">value-based</a> class; use of identity-sensitive operations (including reference equality (<code>==</code>), identity hash code, or synchronization) on instances of <code>ZonedDateTime</code> may have unpredictable results and should be avoided. The <code>equals</code> method should be used for comparisons.</p><p>这是一个 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/lang/doc-files/ValueBased.html" target="_blank" rel="noopener noreferrer">value-based</a> 类；在<code>ZonedDateTime</code>的实例上使用 identity-sensitive 的操作（包括引用相等<code>==</code>、identity hash code 或同步 synchronization）可能会产生不可预测的结果，所以要避免。应该使用 equals 方法来进行比较。</p><p>A <code>ZonedDateTime</code> holds state equivalent to three separate objects, a <code>LocalDateTime</code>, a <code>ZoneId</code> and the resolved <code>ZoneOffset</code>. The offset and local date-time are used to define an instant when necessary. The zone ID is used to obtain the rules for how and when the offset changes. The offset cannot be freely set, as the zone controls which offsets are valid.</p><p>一个<code>ZonedDateTime</code>相当于持有三个独立对象的状态，一个<code>LocalDateTime</code>，一个<code>ZoneId</code>和已解决的<code>ZoneOffset</code>。必要时，偏移量和 local date-time 被用来定义一个瞬间。zone ID 被用来获取偏移量及何时变化的规则。偏移量不能自由设置，因为时区控制着哪些偏移量时有效的。</p><p>This class is immutable and thread-safe.</p><p>这个类是不可变的，并且是线程安全的。</p></blockquote><h2 class="anchor anchorWithStickyNavbar_LWe7" id="withzonesamelocal-和-withzonesameinstant-的使用与区别">withZoneSameLocal 和 withZoneSameInstant 的使用与区别<a href="#withzonesamelocal-和-withzonesameinstant-的使用与区别" class="hash-link" aria-label="withZoneSameLocal 和 withZoneSameInstant 的使用与区别的直接链接" title="withZoneSameLocal 和 withZoneSameInstant 的使用与区别的直接链接">​</a></h2><h3 class="anchor anchorWithStickyNavbar_LWe7" id="withzonesamelocal-简介">withZoneSameLocal 简介<a href="#withzonesamelocal-简介" class="hash-link" aria-label="withZoneSameLocal 简介的直接链接" title="withZoneSameLocal 简介的直接链接">​</a></h3><p>先看 <code>withZoneSameLocal</code> 方法的注释：</p><blockquote><p>Returns a copy of this date-time with a different time-zone, retaining the local date-time if possible.</p><p>This method changes the time-zone and retains the local date-time. The local date-time is only changed if it is invalid for the new zone, determined using the same approach as <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/ZonedDateTime.html#ofLocal(java.time.LocalDateTime,java.time.ZoneId,java.time.ZoneOffset)" target="_blank" rel="noopener noreferrer">ofLocal(LocalDateTime, ZoneId, ZoneOffset)</a>.</p><p>To change the zone and adjust the local date-time, use <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/ZonedDateTime.html#withZoneSameInstant(java.time.ZoneId)" target="_blank" rel="noopener noreferrer">withZoneSameInstant(ZoneId)</a>.</p><p>This instance is immutable and unaffected by this method call.</p><p><code>@param</code> <code>zone</code> – the time-zone to change to, not null</p><p><code>@return</code> a <code>ZonedDateTime</code> based on this date-time with the requested zone, not null</p><p>返回一个具有不同时区的 date-time 的副本，如果可能的话，保留 local date-time。</p><p>这个方法改变了时区并保留了 local date-time。在新的时区无效时，local date-time 才会被改变，与使用 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/ZonedDateTime.html#ofLocal(java.time.LocalDateTime,java.time.ZoneId,java.time.ZoneOffset)" target="_blank" rel="noopener noreferrer">ofLocal(LocalDateTime, ZoneId, ZoneOffset)</a> 方法相同。</p><p>要改变区域并调整 local date-time，请使用 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/ZonedDateTime.html#withZoneSameInstant(java.time.ZoneId)" target="_blank" rel="noopener noreferrer">withZoneSameInstant(ZoneId)</a>。</p><p>被调用实例是不可变的，不受此方法调用的影响。</p><p><code>形参</code>：zone - 要改变的时区，不为 null。</p><p><code>返回值</code>：a ZonedDateTime - 基于该 date-time 的请求时区，不为 null。</p></blockquote><p>简单来说就是修改时区但是保持 local date-time 不变：</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">LocalDateTime localDateTime = LocalDateTime.now();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ZonedDateTime zonedDateTime = localDateTime.atZone(ZoneId.of(&quot;Asia/Shanghai&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(zonedDateTime);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(zonedDateTime.withZoneSameLocal(ZoneId.of(&quot;Europe/Moscow&quot;)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 输出结果为</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-08T18:45:22.711+08:00[Asia/Shanghai]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-08T18:45:22.711+03:00[Europe/Moscow]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="withzonesameinstant-简介">withZoneSameInstant 简介<a href="#withzonesameinstant-简介" class="hash-link" aria-label="withZoneSameInstant 简介的直接链接" title="withZoneSameInstant 简介的直接链接">​</a></h3><p>再看 <code>withZoneSameInstant</code> 方法注释：</p><blockquote><p>Returns a copy of this date-time with a different time-zone, retaining the instant.</p><p>This method changes the time-zone and retains the instant. This normally results in a change to the local date-time.</p><p>This method is based on retaining the same instant, thus gaps and overlaps in the local time-line have no effect on the result.</p><p>To change the offset while keeping the local time, use <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/ZonedDateTime.html#withZoneSameLocal(java.time.ZoneId)" target="_blank" rel="noopener noreferrer">withZoneSameLocal(ZoneId)</a>.</p><p><code>@param</code> <code>zone</code> – the time-zone to change to, not null</p><p><code>@return</code> a <code>ZonedDateTime</code> based on this date-time with the requested zone, not null</p><p><code>@throws</code> <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/DateTimeException.html" target="_blank" rel="noopener noreferrer">DateTimeException</a> – if the result exceeds the supported date range</p><p>返回一个具有不同时区的 date-time 的副本，保留 instant。</p><p>这个方法改变了时区并保留了 instant。这通常会导致 local date-time 的改变。</p><p>这个方法是基于保留相同的 instant，因此本地时间线的间歇和重叠对结果没有影响。</p><p>要保持 local date-time 的同时改变偏移量，请使用 <a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/ZonedDateTime.html#withZoneSameLocal(java.time.ZoneId)" target="_blank" rel="noopener noreferrer">withZoneSameLocal(ZoneId)</a>。</p><p><code>形参</code>：<code>zone</code> - 要改变的时区，不为 null。</p><p><code>返回值</code>：a <code>ZonedDateTime</code> - 基于该 date-time 的请求时区，不为 null。</p><p><code>抛出</code>：<a href="https://docs.oracle.com/en/java/javase/17/docs/api/java.base/java/time/DateTimeException.html" target="_blank" rel="noopener noreferrer">DateTimeException</a> – 如果结果超出了支持的日期范围。</p></blockquote><p>简单来说就是修改时区但是保持 instant 不变。因为时区变了，偏移量肯定变了，所以 local date-time 也会改变以保持 instant 不变。</p><div class="language-java codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-java codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">LocalDateTime localDateTime = LocalDateTime.now();</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ZonedDateTime zonedDateTime = localDateTime.atZone(ZoneId.of(&quot;Asia/Shanghai&quot;));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(zonedDateTime);</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System.out.println(zonedDateTime.withZoneSameInstant(ZoneId.of(&quot;Europe/Moscow&quot;)));</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">// 输出结果为</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-09T20:06:35.753+08:00[Asia/Shanghai]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2022-08-09T15:06:35.753+03:00[Europe/Moscow]</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2>……</h2><h2 class="anchor anchorWithStickyNavbar_LWe7" id="疑问">疑问<a href="#疑问" class="hash-link" aria-label="疑问的直接链接" title="疑问的直接链接">​</a></h2><p>我了解的并不全面，或者是因为英语能力有限，原本要和上下文关联理解的地方没翻译好，导致我有以下疑问。如果你知道，欢迎联系我！</p><ul><li>文中“or the previous offset is invalid”、“The local date-time is only changed if it is invalid for the new zone”这两段话的无效偏移量、时区具体指的是什么？</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="参考">参考<a href="#参考" class="hash-link" aria-label="参考的直接链接" title="参考的直接链接">​</a></h2><ul><li><a href="https://zh.wikipedia.org/wiki/%E6%97%B6%E5%8C%BA%E4%BF%A1%E6%81%AF%E6%95%B0%E6%8D%AE%E5%BA%93" target="_blank" rel="noopener noreferrer">时区信息数据库 - 维基百科，自由的百科全书</a></li><li><a href="https://en.wikipedia.org/wiki/List_of_tz_database_time_zones" target="_blank" rel="noopener noreferrer">List of tz database time zones - Wikipedia</a></li><li><a href="https://zh.wikipedia.org/wiki/%E5%A4%8F%E4%BB%A4%E6%97%B6" target="_blank" rel="noopener noreferrer">夏令时 - 维基百科，自由的百科全书</a></li></ul></div><footer class="row docusaurus-mt-lg"><div class="col"><b>标签：</b><ul class="tags_jXut padding--none margin-left--sm"><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/ZUtil/blog/tags/time">time</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/ZUtil/blog/tags/zone">zone</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/ZUtil/blog/tags/时区">时区</a></li><li class="tag_QGVx"><a class="tag_zVej tagRegular_sFm0" href="/ZUtil/blog/tags/时间">时间</a></li></ul></div></footer></article><nav class="pagination-nav" aria-label="博文列表分页导航"></nav></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/ZUtil/docs/intro">教程</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://jq.qq.com/?_wv=1027&amp;k=Jzpzg0lc" target="_blank" rel="noopener noreferrer" class="footer__link-item">QQ 群<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/duanluan/ZUtil/discussions" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Discussions<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://segmentfault.com/search?q=zutil&amp;type=qa" target="_blank" rel="noopener noreferrer" class="footer__link-item">SegmentFault 问答<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://www.oschina.net/search?scope=bbs&amp;q=zutil" target="_blank" rel="noopener noreferrer" class="footer__link-item">开源中国问答<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://so.csdn.net/so/search?q=zutil&amp;t=ask" target="_blank" rel="noopener noreferrer" class="footer__link-item">CSDN 问答<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/ZUtil/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/duanluan/ZUtil" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://gitee.com/duanluan/ZUtil" target="_blank" rel="noopener noreferrer" class="footer__link-item">Gitee<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2023 ZUtil, Inc. Built with duanluan.</div></div></div></footer></div>
<script src="/ZUtil/assets/js/runtime~main.90331c9c.js"></script>
<script src="/ZUtil/assets/js/main.47fca1f3.js"></script>
</body>
</html>